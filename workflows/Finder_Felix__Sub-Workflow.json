{
  "updatedAt": "2025-09-10T16:51:11.000Z",
  "createdAt": "2025-08-28T16:14:18.478Z",
  "id": "EYEbcs1sZO2Sm7l2",
  "name": "Finder Felix / Sub-Workflow",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1504,
        400
      ],
      "id": "048d1320-e5f3-47f2-85ec-8c7611bf7b4f",
      "name": "Search Request",
      "retryOnFail": true,
      "waitBetweenTries": 1500,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "url": "={{ $json.URL }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1200,
        720
      ],
      "id": "180d7f7d-a970-48f1-aec6-de50277700ec",
      "name": "Detail Request",
      "retryOnFail": true
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "companies",
              "cssSelector": "#gs_treffer",
              "returnValue": "html"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        1936,
        480
      ],
      "id": "84dcf5ad-82f3-4913-940f-0fdc90777d0c",
      "name": "Extract Company Cards"
    },
    {
      "parameters": {
        "fieldToSplitOut": "detailUrls",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        2576,
        480
      ],
      "id": "e3f1c55f-f452-475d-93fc-fe442e3bf12c",
      "name": "Split Out Detail Pages"
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "contactInfo",
              "cssSelector": ".mod-Kontaktdaten__container--inner",
              "returnValue": "html"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        1376,
        720
      ],
      "id": "879275e1-96a4-411a-95fd-27935854aef8",
      "name": "Extract Info Section"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const inputString = $input.item.json.contactInfo || \"\";\n\n// small helper\nconst decodeHtml = (s='') =>\n  s.replace(/&amp;/g,'&').replace(/&quot;/g,'\"').replace(/&#39;/g,\"'\")\n   .replace(/&lt;/g,'<').replace(/&gt;/g,'>');\n\nconst result = {\n  companyName: null,\n  street: null,\n  city: null,\n  fullAddress: null,\n  phoneNumber: null,\n  website: null\n};\n\n// --- Company name ---\n{\n  // your original selector\n  let m = inputString.match(/<div class=\"gc-text--h2\">([^<]+)<\\/div>/);\n  // fallback: sometimes wrapped in h2/a\n  if (!m) m = inputString.match(/<h2[^>]*>(?:\\s*<a[^>]*>)?([^<]+)(?:<\\/a>)?<\\/h2>/i);\n  if (m) result.companyName = m[1].trim();\n}\n\n// --- Address (street + PLZ city) ---\n{\n  // your original selector\n  let m = inputString.match(/<span>([^<]+), <\\/span>\\s*<span>([^<]+)<\\/span>/);\n  // fallback: capture street then a span containing a 5-digit PLZ\n  if (!m) {\n    m = inputString.match(/<span[^>]*>([^<]*\\d[^<]*?)<\\/span>.*?<span[^>]*>(\\d{5}\\s+[^<]+)<\\/span>/is);\n  }\n  if (m) {\n    result.street = m[1].trim();\n    result.city   = m[2].trim();\n    result.fullAddress = `${result.street}, ${result.city}`;\n  }\n}\n\n// --- Phone ---\n{\n  // simpler: any tel: link\n  const m = inputString.match(/href=\"tel:([^\"]+)\"/i);\n  if (m) result.phoneNumber = m[1].replace(/\\s+/g,' ').trim();\n}\n\n// --- Website (more robust) ---\n(function extractWebsite(){\n  const html = inputString;\n\n  // Try several patterns in order:\n  const patterns = [\n    // explicit Website text (DE variations)\n    /<a[^>]+href=\"(https?:\\/\\/[^\"]+)\"[^>]*>\\s*(?:<[^>]+>)*\\s*(?:Webseite|Website|Zur\\s*Webseite|Zur\\s*Website|Homepage|Internet(?:seite)?)\\s*(?:<[^>]+>)*\\s*<\\/a>/i,\n\n    // link with a \"web\" icon class\n    /<a[^>]+class=\"[^\"]*contains-icon-web[^\"]*\"[^>]+href=\"(https?:\\/\\/[^\"]+)\"/i,\n\n    // generic external link inside contact block\n    /<a[^>]+href=\"(https?:\\/\\/(?!www\\.gelbeseiten\\.de)[^\"]+)\"[^>]*target=\"_blank\"[^>]*>/i,\n\n    // protocol-relative URL (starts with //)\n    /<a[^>]+href=\"(\\/\\/[^\"]+)\"[^>]*>\\s*(?:<[^>]+>)*\\s*(?:Webseite|Website|Homepage)[^<]*<\\/a>/i,\n\n    // data attribute occasionally used\n    /data-website-url=\"(https?:\\/\\/[^\"]+)\"/i,\n  ];\n\n  for (const p of patterns) {\n    const m = html.match(p);\n    if (m) {\n      let u = decodeHtml(m[1].trim());\n      if (u.startsWith('//')) u = 'https:' + u;\n      result.website = u;\n      return;\n    }\n  }\n\n  // last resort: pick any external http(s) link that isn't tel: or mailto: or gelbeseiten domain\n  const any = html.match(/href=\"(https?:\\/\\/[^\"]+)\"/ig);\n  if (any) {\n    const firstExternal = any\n      .map(s => decodeHtml(s.replace(/^href=\"|\\\"$/g,'')))\n      .find(u => !/gelbeseiten\\.de/i.test(u));\n    if (firstExternal) result.website = firstExternal;\n  }\n})();\n\nreturn { contactInfo: result };\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1776,
        720
      ],
      "id": "06bae0d2-a036-45fe-b4d7-f6a7a84f4bb3",
      "name": "Extract Cotact Info"
    },
    {
      "parameters": {
        "jsCode": "const inputString = $input.item.json.companies;\n\n// RegEx zum Extrahieren aller hrefs, die auf Detailseiten verweisen (z.B. \"https://www.gelbeseiten.de/gsbiz/e05a7433-e767-44a1-b350-96c52e4d44ea\")\nconst hrefRegex = /href=\"(https:\\/\\/www\\.gelbeseiten\\.de\\/gsbiz\\/[a-z0-9-]+)/g;\n\n// Alle URLs extrahieren\nconst matches = [];\nlet match;\n\nwhile ((match = hrefRegex.exec(inputString)) !== null) {\n  matches.push({ URL: match[1] });\n}\n\n// Rückgabe als Array von Objekten\nreturn [\n  {\n    json: {\n      detailUrls: matches\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2144,
        480
      ],
      "id": "c18fc3f1-babb-490b-8564-44d26230fe9c",
      "name": "Extract Detail Pages"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1104,
        304
      ],
      "id": "384e6920-b3c1-4ab3-a312-8eaaa752bf9b",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "tableId": "german_companies",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "company",
              "fieldValue": "={{ $json.company }}"
            },
            {
              "fieldId": "industry",
              "fieldValue": "={{ $('Finder Felix').item.json.output.industry }}"
            },
            {
              "fieldId": "phone",
              "fieldValue": "={{ $json.phone }}"
            },
            {
              "fieldId": "website",
              "fieldValue": "={{ $json.website || '' }}"
            },
            {
              "fieldId": "address",
              "fieldValue": "={{ $json.address }}"
            },
            {
              "fieldId": "populated_by",
              "fieldValue": "={{ $json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2816,
        736
      ],
      "id": "5e771290-4ca7-4a96-bb1d-9a7779a82db8",
      "name": "Add Company",
      "credentials": {
        "supabaseApi": {
          "id": "fdzgJDGuPA2JozKn",
          "name": "Supabase account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f31926ac-a9ad-44b9-8875-0d661987bcdf",
              "leftValue": "={{ $json.data }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1680,
        400
      ],
      "id": "02fb046d-3a86-4c61-a323-e9de5680bb4f",
      "name": "If"
    },
    {
      "parameters": {
        "compare": "selectedFields",
        "fieldsToCompare": "contactInfo.phoneNumber",
        "options": {}
      },
      "type": "n8n-nodes-base.removeDuplicates",
      "typeVersion": 2,
      "position": [
        1952,
        720
      ],
      "id": "9f15787e-6741-42b9-b87f-1145be75a94d",
      "name": "Remove Duplicates"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.message.chat.id }}1"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -544,
        608
      ],
      "id": "3971c7cd-21a5-4381-a720-5476f267106a",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.message.text }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=Rolle\n\nDu bist FinderFelix – digitaler Recherche-Praktikant mit Köpfchen. Locker, schnell, direkt.\nDein Job: rausfinden, was (Branche) und wo (PLZ oder Stadt) gesucht wird, damit passende Firmen auf Gelbe Seiten gefunden werden können.\n\nWas du brauchst\n\nEine Postleitzahl (PLZ) oder eine Stadt\n\nEine Branche (z. B. Zahnärzte, Steuerberater)\n\nRegeln\n\nWenn eine PLZ im Input vorkommt (\\b\\d{5}\\b):\n\nSpeichere sie als postalCode\n\nSetze lookupType = \"postal_code\"\n\nStadt/District nicht ableiten\n\nWenn eine Stadt vorkommt (keine PLZ):\n\nSpeichere sie als city\n\nSetze lookupType = \"city\"\n\nWenn Branche oder Ort fehlt:\n\nStelle eine kurze Rückfrage (max. 1 Satz)\n\nStartsignal:\n\nstartScraping = true, wenn Branche und (PLZ oder Stadt) eindeutig vorliegen\n\nAntwortstil\n\nKurz, frech, freundlich\n\nDu sprichst den User als „Boss“ oder „Chef“ an\n\nKein Gelaber, keine Floskeln\n\nImmer direkt: „Zahnärzte in 35633 – läuft, Boss!“\n\nAusgabeformat\n\nAntworte ausschließlich mit einem gültigen JSON-Objekt in folgendem Format:\n\n{\n  \"userMessage\": \"\",\n  \"finderFelixAnswer\": \"\",\n  \"industry\": \"\",\n  \"postalCode\": \"\",\n  \"city\": \"\",\n  \"lookupType\": \"\",\n  \"startScraping\": false\n}\n\nBeispiel Outputs\nA) PLZ vorhanden\n{\n  \"userMessage\": \"Bitte alle Zahnärzte in 35633 finden.\",\n  \"finderFelixAnswer\": \"Zahnärzte in 35633 – läuft, Boss!\",\n  \"industry\": \"Zahnärzte\",\n  \"postalCode\": \"35633\",\n  \"city\": \"\",\n  \"lookupType\": \"postal_code\",\n  \"startScraping\": true\n}\n\nB) Stadt vorhanden\n{\n  \"userMessage\": \"Suche Steuerberater in Wetzlar\",\n  \"finderFelixAnswer\": \"Steuerberater in Wetzlar – läuft, Boss!\",\n  \"industry\": \"Steuerberater\",\n  \"postalCode\": \"\",\n  \"city\": \"Wetzlar\",\n  \"lookupType\": \"city\",\n  \"startScraping\": true\n}\n\nC) Rückfrage nötig\n{\n  \"userMessage\": \"35633\",\n  \"finderFelixAnswer\": \"Welche Branche soll ich in 35633 suchen, Boss?\",\n  \"industry\": \"\",\n  \"postalCode\": \"35633\",\n  \"city\": \"\",\n  \"lookupType\": \"postal_code\",\n  \"startScraping\": false\n}\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -416,
        368
      ],
      "id": "03c09243-cf5b-416f-a84f-9a09921b7011",
      "name": "Finder Felix"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "german_cities",
        "filters": {
          "conditions": [
            {
              "keyName": "state",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -400,
        608
      ],
      "id": "f1ef7ca5-4390-4881-a98b-a5915685a8e6",
      "name": "Check_State",
      "credentials": {
        "supabaseApi": {
          "id": "fdzgJDGuPA2JozKn",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "german_cities",
        "filters": {
          "conditions": [
            {
              "keyName": "city",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -256,
        608
      ],
      "id": "52fb9451-5d77-4cc6-99c5-85fe4e713a95",
      "name": "Check_City",
      "credentials": {
        "supabaseApi": {
          "id": "fdzgJDGuPA2JozKn",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "german_districts",
        "filters": {
          "conditions": [
            {
              "keyName": "district",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -112,
        608
      ],
      "id": "2bc805b4-9c7f-472c-b098-e940f8f6c676",
      "name": "Check_District",
      "credentials": {
        "supabaseApi": {
          "id": "fdzgJDGuPA2JozKn",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4d17cc19-9718-4ca8-8a95-71655e348f07",
              "leftValue": "={{ $('Finder Felix').item.json.output.industry }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "fc028b7e-c3fe-4730-93e7-46a4f7030dfa",
              "leftValue": "={{ $('Finder Felix').item.json.output.lookupType }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "664fa3e0-b57a-4f48-abe2-abed4edb9fdf",
              "leftValue": "={{ $('Finder Felix').item.json.output.startScraping }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        304,
        368
      ],
      "id": "cdba4195-dd77-4c61-a05e-b163034c05a9",
      "name": "Start Scraping"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Finder Felix').item.json.output.lookupType }}",
                    "rightValue": "state",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "583a0988-22cd-4b0d-9414-48fb3a1c48fa"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Scrape State"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "eb932fbc-cf49-4a60-bd1e-deb8e826782b",
                    "leftValue": "={{ $('Finder Felix').item.json.output.lookupType }}",
                    "rightValue": "city",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Scrape City"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f0d45210-8f03-4e4b-86f9-ade6b9fd36c6",
                    "leftValue": "={{ $('Finder Felix').item.json.output.lookupType }}",
                    "rightValue": "district",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Scrape District"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a233ce9c-37dd-4d80-a12a-cddf74cc0503",
                    "leftValue": "={{ $('Finder Felix').item.json.output.lookupType }}",
                    "rightValue": "postal_code",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "postal_code"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        544,
        288
      ],
      "id": "d12b07ae-511b-4ed3-ac87-b00aaabd77a3",
      "name": "Switch"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "german_districts",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "city",
              "condition": "ilike",
              "keyValue": "={{ $('Finder Felix').item.json.output.city }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        832,
        192
      ],
      "id": "99350954-6488-463f-8fd7-d6a8be88b07f",
      "name": "Get City",
      "credentials": {
        "supabaseApi": {
          "id": "fdzgJDGuPA2JozKn",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "51746dd0-2087-430b-aef5-76424ac07607",
              "name": "supabaseProjectID",
              "value": "sbbaxnrkennoyqxcpxmq",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -592,
        368
      ],
      "id": "5e3a243c-05d7-4db0-b350-aabd8fe4f460",
      "name": "ENV"
    },
    {
      "parameters": {
        "jsCode": "// Pull structured output once\nconst out = $('Finder Felix').first().json.output || {};\n\n// Back-compat shim (if some nodes still send locationType)\nout.lookupType = out.lookupType || out.locationType || '';\n\n// --- helpers ---\nconst slug = (s) => String(s || '')\n  .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n  .replace(/ä/g,'ae').replace(/ö/g,'oe').replace(/ü/g,'ue')\n  .replace(/Ä/g,'Ae').replace(/Ö/g,'Oe').replace(/Ü/g,'Ue')\n  .replace(/ß/g,'ss')\n  .toLowerCase()\n  .trim()\n  .replace(/[^a-z0-9]+/g,'-')\n  .replace(/^-+|-+$/g,'');\n\n// Minimal industry → slug map (extend as needed)\nconst industryMap = {\n  'zahnärzte': 'zahnarzt',\n  'zahnarzt': 'zahnarzt',\n  'dentists': 'zahnarzt',\n  'steuerberater': 'steuerberater',\n  'anwalt': 'rechtsanwalt',\n};\nconst rawIndustry = String(out.industry || '').toLowerCase().trim();\nconst categorySlug = industryMap[rawIndustry] || slug(rawIndustry) || 'zahnarzt';\n\n// Resolve location from lookupType\nlet locationSegment = '';\nif (out.lookupType === 'postal_code') {\n  locationSegment = String(out.postalCode || '').trim();\n} else if (out.lookupType === 'city') {\n  locationSegment = slug(out.city);\n} else {\n  throw new Error('lookupType must be \"postal_code\" or \"city\".');\n}\nif (!locationSegment) throw new Error('Missing location (postalCode or city).');\n\n// Build URLs\nconst sucheUrl = `https://www.gelbeseiten.de/suche/${categorySlug}/${encodeURIComponent(locationSegment)}`;\n// Optional alternate:\n// const branchenUrl = `https://www.gelbeseiten.de/branchen/${categorySlug}/${encodeURIComponent(locationSegment)}`;\n\nreturn [\n  {\n    json: {\n      url: sucheUrl,\n      // altUrl: branchenUrl,   // uncomment if you want a fallback candidate\n      parts: {\n        lookupType: out.lookupType,\n        categorySlug,\n        locationSegment\n      },\n      debug: {\n        industryInput: out.industry,\n        cityInput: out.city || '',\n        postalCodeInput: out.postalCode || ''\n      }\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1312,
        400
      ],
      "id": "d6e3acfe-dad5-40b8-8f82-09394f512bd1",
      "name": "Build URL"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "german_districts",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "state",
              "condition": "ilike",
              "keyValue": "={{ $('Finder Felix').item.json.output.state }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        832,
        0
      ],
      "id": "5034a563-f2f9-431f-8714-8b6aa2479fc8",
      "name": "Get State",
      "credentials": {
        "supabaseApi": {
          "id": "fdzgJDGuPA2JozKn",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Just needed to run Once for all items in order to prevent multiple Telegram messages\n\nreturn $input.first();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1312,
        224
      ],
      "id": "6b9efb96-f351-461c-82e1-9f313624d79f",
      "name": "Code"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "userMessage"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -1600,
        208
      ],
      "id": "f4542468-6798-4f3a-8730-fcd5f36bbe85",
      "name": "Team Leader"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -704,
        608
      ],
      "id": "a0bb6f9b-162a-4d80-bf3a-11d2a2a27097",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "RMCgUrxutvJgFiK9",
          "name": "Adams Test OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"userMessage\": \"Bitte alle Zahnärzte in 35633 finden.\",\n  \"finderFelixAnswer\": \"Zahnärzte in 35633 – läuft, Boss!\",\n  \"industry\": \"Zahnärzte\",\n  \"postalCode\": \"35633\",\n  \"city\": \"\",\n  \"lookupType\": \"postal_code\",\n  \"startScraping\": true\n}\n"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        16,
        608
      ],
      "id": "c512508f-88f4-4da4-981a-702188def6d3",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "content": "## Finder Felix\n",
        "height": 1088,
        "width": 1936,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1680,
        -64
      ],
      "id": "0d0680d5-7319-43e1-b6f5-9602cf1de121",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "167pvvSqPMJdFm9r-aJRDDTXlWd_N7IwzvY1oz_7gals",
          "mode": "list",
          "cachedResultName": "Companies - AI Sales Team",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/167pvvSqPMJdFm9r-aJRDDTXlWd_N7IwzvY1oz_7gals/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Tabellenblatt1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/167pvvSqPMJdFm9r-aJRDDTXlWd_N7IwzvY1oz_7gals/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "company": "={{ $json.contactInfo.companyName }}",
            "phone": "={{ $json.contactInfo.phoneNumber }}",
            "website": "={{ $json.contactInfo.website }}",
            "address": "={{ $json.contactInfo.fullAddress }}",
            "industry": "={{ $('Finder Felix').item.json.output.industry }}",
            "state": "={{ $('Loop Over Items').item.json.state }}",
            "city": "={{ $('Loop Over Items').item.json.city }}",
            "district": "={{ $('Loop Over Items').item.json.district }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "company",
              "displayName": "company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "industry",
              "displayName": "industry",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "phone",
              "displayName": "phone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "website",
              "displayName": "website",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "address",
              "displayName": "address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "state",
              "displayName": "state",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "city",
              "displayName": "city",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "district",
              "displayName": "district",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        2144,
        720
      ],
      "id": "047efc07-a24a-438d-b2e1-f1a9d63fdf5c",
      "name": "Append row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "qJ5ck4AVx9Jx37Fr",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let message = '';\nif($prevNode.name === 'Team Leader'){\n  \n  message = { \n    text: $input.first().json.userMessage\n  };\n}else if($prevNode.name === 'Message Felix'){\n  message = $input.first().json.message;\n}\n\nreturn {\n  message: message\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -768,
        368
      ],
      "id": "20455ef4-2724-443a-9ebf-5db0b9ea1b02",
      "name": "Code1"
    },
    {
      "parameters": {
        "tableId": "finder_felix_executions",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "execution",
              "fieldValue": "={{ $execution.id }}"
            },
            {
              "fieldId": "postal_code",
              "fieldValue": "={{ $('Loop Over Items').item.json.output.postalCode }}"
            },
            {
              "fieldId": "num_results",
              "fieldValue": "={{ $input.all().length }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2368,
        816
      ],
      "id": "384d91af-91a3-47e0-aa22-3c2ec50bcbcb",
      "name": "Create a row",
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "fdzgJDGuPA2JozKn",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        2576,
        736
      ],
      "id": "0bf09536-71e9-49f7-929c-71210845b2d6",
      "name": "Merge"
    },
    {
      "parameters": {
        "content": "",
        "height": 848,
        "width": 2048,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        976,
        176
      ],
      "id": "f805b85f-2e94-4ef4-8e0e-8b59a873ec47",
      "name": "Sticky Note1"
    }
  ],
  "connections": {
    "Search Request": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Detail Request": {
      "main": [
        [
          {
            "node": "Extract Info Section",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Company Cards": {
      "main": [
        [
          {
            "node": "Extract Detail Pages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out Detail Pages": {
      "main": [
        [
          {
            "node": "Detail Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Info Section": {
      "main": [
        [
          {
            "node": "Extract Cotact Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Cotact Info": {
      "main": [
        [
          {
            "node": "Remove Duplicates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Detail Pages": {
      "main": [
        [
          {
            "node": "Split Out Detail Pages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Build URL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Company": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Extract Company Cards",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Remove Duplicates": {
      "main": [
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "Finder Felix",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Finder Felix": {
      "main": [
        [
          {
            "node": "Start Scraping",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check_State": {
      "ai_tool": [
        [
          {
            "node": "Finder Felix",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Check_City": {
      "ai_tool": [
        [
          {
            "node": "Finder Felix",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Check_District": {
      "ai_tool": [
        [
          {
            "node": "Finder Felix",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Start Scraping": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Get State",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get City",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get City": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ENV": {
      "main": [
        [
          {
            "node": "Finder Felix",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build URL": {
      "main": [
        [
          {
            "node": "Search Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get State": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        []
      ]
    },
    "Team Leader": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Finder Felix",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Finder Felix",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet": {
      "main": [
        [
          {
            "node": "Create a row",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "ENV",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a row": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Add Company",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Team Leader": [
      {
        "json": {
          "userMessage": "please find all Dentists in Postal code 35633 in Hessen"
        }
      }
    ],
    "Extract Detail Pages": [
      {
        "json": {
          "detailUrls": [
            {
              "URL": "https://www.gelbeseiten.de/gsbiz/b7fba8d7-14d9-4a8f-830b-f630255c79c9"
            },
            {
              "URL": "https://www.gelbeseiten.de/gsbiz/6949c34a-0ce0-4c8b-8f78-f45d8c78ddcd"
            },
            {
              "URL": "https://www.gelbeseiten.de/gsbiz/1adf23ad-ea31-44e8-8302-7f17a1d7f761"
            }
          ]
        }
      }
    ]
  },
  "versionId": "767d0fe8-f7e6-465e-8b35-3ec99431d86f",
  "activeVersionId": "767d0fe8-f7e6-465e-8b35-3ec99431d86f",
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-08-28T16:14:18.487Z",
      "createdAt": "2025-08-28T16:14:18.487Z",
      "role": "workflow:owner",
      "workflowId": "EYEbcs1sZO2Sm7l2",
      "projectId": "B7QJE85HA2Vij1it"
    }
  ],
  "activeVersion": {
    "updatedAt": "2025-11-26T20:39:59.471Z",
    "createdAt": "2025-11-26T20:39:59.471Z",
    "versionId": "767d0fe8-f7e6-465e-8b35-3ec99431d86f",
    "workflowId": "EYEbcs1sZO2Sm7l2",
    "nodes": [
      {
        "parameters": {
          "url": "={{ $json.url }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1504,
          400
        ],
        "id": "048d1320-e5f3-47f2-85ec-8c7611bf7b4f",
        "name": "Search Request",
        "retryOnFail": true,
        "waitBetweenTries": 1500,
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "url": "={{ $json.URL }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1200,
          720
        ],
        "id": "180d7f7d-a970-48f1-aec6-de50277700ec",
        "name": "Detail Request",
        "retryOnFail": true
      },
      {
        "parameters": {
          "operation": "extractHtmlContent",
          "extractionValues": {
            "values": [
              {
                "key": "companies",
                "cssSelector": "#gs_treffer",
                "returnValue": "html"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.html",
        "typeVersion": 1.2,
        "position": [
          1936,
          480
        ],
        "id": "84dcf5ad-82f3-4913-940f-0fdc90777d0c",
        "name": "Extract Company Cards"
      },
      {
        "parameters": {
          "fieldToSplitOut": "detailUrls",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          2576,
          480
        ],
        "id": "e3f1c55f-f452-475d-93fc-fe442e3bf12c",
        "name": "Split Out Detail Pages"
      },
      {
        "parameters": {
          "operation": "extractHtmlContent",
          "extractionValues": {
            "values": [
              {
                "key": "contactInfo",
                "cssSelector": ".mod-Kontaktdaten__container--inner",
                "returnValue": "html"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.html",
        "typeVersion": 1.2,
        "position": [
          1376,
          720
        ],
        "id": "879275e1-96a4-411a-95fd-27935854aef8",
        "name": "Extract Info Section"
      },
      {
        "parameters": {
          "mode": "runOnceForEachItem",
          "jsCode": "const inputString = $input.item.json.contactInfo || \"\";\n\n// small helper\nconst decodeHtml = (s='') =>\n  s.replace(/&amp;/g,'&').replace(/&quot;/g,'\"').replace(/&#39;/g,\"'\")\n   .replace(/&lt;/g,'<').replace(/&gt;/g,'>');\n\nconst result = {\n  companyName: null,\n  street: null,\n  city: null,\n  fullAddress: null,\n  phoneNumber: null,\n  website: null\n};\n\n// --- Company name ---\n{\n  // your original selector\n  let m = inputString.match(/<div class=\"gc-text--h2\">([^<]+)<\\/div>/);\n  // fallback: sometimes wrapped in h2/a\n  if (!m) m = inputString.match(/<h2[^>]*>(?:\\s*<a[^>]*>)?([^<]+)(?:<\\/a>)?<\\/h2>/i);\n  if (m) result.companyName = m[1].trim();\n}\n\n// --- Address (street + PLZ city) ---\n{\n  // your original selector\n  let m = inputString.match(/<span>([^<]+), <\\/span>\\s*<span>([^<]+)<\\/span>/);\n  // fallback: capture street then a span containing a 5-digit PLZ\n  if (!m) {\n    m = inputString.match(/<span[^>]*>([^<]*\\d[^<]*?)<\\/span>.*?<span[^>]*>(\\d{5}\\s+[^<]+)<\\/span>/is);\n  }\n  if (m) {\n    result.street = m[1].trim();\n    result.city   = m[2].trim();\n    result.fullAddress = `${result.street}, ${result.city}`;\n  }\n}\n\n// --- Phone ---\n{\n  // simpler: any tel: link\n  const m = inputString.match(/href=\"tel:([^\"]+)\"/i);\n  if (m) result.phoneNumber = m[1].replace(/\\s+/g,' ').trim();\n}\n\n// --- Website (more robust) ---\n(function extractWebsite(){\n  const html = inputString;\n\n  // Try several patterns in order:\n  const patterns = [\n    // explicit Website text (DE variations)\n    /<a[^>]+href=\"(https?:\\/\\/[^\"]+)\"[^>]*>\\s*(?:<[^>]+>)*\\s*(?:Webseite|Website|Zur\\s*Webseite|Zur\\s*Website|Homepage|Internet(?:seite)?)\\s*(?:<[^>]+>)*\\s*<\\/a>/i,\n\n    // link with a \"web\" icon class\n    /<a[^>]+class=\"[^\"]*contains-icon-web[^\"]*\"[^>]+href=\"(https?:\\/\\/[^\"]+)\"/i,\n\n    // generic external link inside contact block\n    /<a[^>]+href=\"(https?:\\/\\/(?!www\\.gelbeseiten\\.de)[^\"]+)\"[^>]*target=\"_blank\"[^>]*>/i,\n\n    // protocol-relative URL (starts with //)\n    /<a[^>]+href=\"(\\/\\/[^\"]+)\"[^>]*>\\s*(?:<[^>]+>)*\\s*(?:Webseite|Website|Homepage)[^<]*<\\/a>/i,\n\n    // data attribute occasionally used\n    /data-website-url=\"(https?:\\/\\/[^\"]+)\"/i,\n  ];\n\n  for (const p of patterns) {\n    const m = html.match(p);\n    if (m) {\n      let u = decodeHtml(m[1].trim());\n      if (u.startsWith('//')) u = 'https:' + u;\n      result.website = u;\n      return;\n    }\n  }\n\n  // last resort: pick any external http(s) link that isn't tel: or mailto: or gelbeseiten domain\n  const any = html.match(/href=\"(https?:\\/\\/[^\"]+)\"/ig);\n  if (any) {\n    const firstExternal = any\n      .map(s => decodeHtml(s.replace(/^href=\"|\\\"$/g,'')))\n      .find(u => !/gelbeseiten\\.de/i.test(u));\n    if (firstExternal) result.website = firstExternal;\n  }\n})();\n\nreturn { contactInfo: result };\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1776,
          720
        ],
        "id": "06bae0d2-a036-45fe-b4d7-f6a7a84f4bb3",
        "name": "Extract Cotact Info"
      },
      {
        "parameters": {
          "jsCode": "const inputString = $input.item.json.companies;\n\n// RegEx zum Extrahieren aller hrefs, die auf Detailseiten verweisen (z.B. \"https://www.gelbeseiten.de/gsbiz/e05a7433-e767-44a1-b350-96c52e4d44ea\")\nconst hrefRegex = /href=\"(https:\\/\\/www\\.gelbeseiten\\.de\\/gsbiz\\/[a-z0-9-]+)/g;\n\n// Alle URLs extrahieren\nconst matches = [];\nlet match;\n\nwhile ((match = hrefRegex.exec(inputString)) !== null) {\n  matches.push({ URL: match[1] });\n}\n\n// Rückgabe als Array von Objekten\nreturn [\n  {\n    json: {\n      detailUrls: matches\n    }\n  }\n];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2144,
          480
        ],
        "id": "c18fc3f1-babb-490b-8564-44d26230fe9c",
        "name": "Extract Detail Pages"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          1104,
          304
        ],
        "id": "384e6920-b3c1-4ab3-a312-8eaaa752bf9b",
        "name": "Loop Over Items"
      },
      {
        "parameters": {
          "tableId": "german_companies",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "company",
                "fieldValue": "={{ $json.company }}"
              },
              {
                "fieldId": "industry",
                "fieldValue": "={{ $('Finder Felix').item.json.output.industry }}"
              },
              {
                "fieldId": "phone",
                "fieldValue": "={{ $json.phone }}"
              },
              {
                "fieldId": "website",
                "fieldValue": "={{ $json.website || '' }}"
              },
              {
                "fieldId": "address",
                "fieldValue": "={{ $json.address }}"
              },
              {
                "fieldId": "populated_by",
                "fieldValue": "={{ $json.id }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          2816,
          736
        ],
        "id": "5e771290-4ca7-4a96-bb1d-9a7779a82db8",
        "name": "Add Company",
        "credentials": {
          "supabaseApi": {
            "id": "fdzgJDGuPA2JozKn",
            "name": "Supabase account"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "f31926ac-a9ad-44b9-8875-0d661987bcdf",
                "leftValue": "={{ $json.data }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1680,
          400
        ],
        "id": "02fb046d-3a86-4c61-a323-e9de5680bb4f",
        "name": "If"
      },
      {
        "parameters": {
          "compare": "selectedFields",
          "fieldsToCompare": "contactInfo.phoneNumber",
          "options": {}
        },
        "type": "n8n-nodes-base.removeDuplicates",
        "typeVersion": 2,
        "position": [
          1952,
          720
        ],
        "id": "9f15787e-6741-42b9-b87f-1145be75a94d",
        "name": "Remove Duplicates"
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $json.message.chat.id }}1"
        },
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "typeVersion": 1.3,
        "position": [
          -544,
          608
        ],
        "id": "3971c7cd-21a5-4381-a720-5476f267106a",
        "name": "Simple Memory"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.message.text }}",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=Rolle\n\nDu bist FinderFelix – digitaler Recherche-Praktikant mit Köpfchen. Locker, schnell, direkt.\nDein Job: rausfinden, was (Branche) und wo (PLZ oder Stadt) gesucht wird, damit passende Firmen auf Gelbe Seiten gefunden werden können.\n\nWas du brauchst\n\nEine Postleitzahl (PLZ) oder eine Stadt\n\nEine Branche (z. B. Zahnärzte, Steuerberater)\n\nRegeln\n\nWenn eine PLZ im Input vorkommt (\\b\\d{5}\\b):\n\nSpeichere sie als postalCode\n\nSetze lookupType = \"postal_code\"\n\nStadt/District nicht ableiten\n\nWenn eine Stadt vorkommt (keine PLZ):\n\nSpeichere sie als city\n\nSetze lookupType = \"city\"\n\nWenn Branche oder Ort fehlt:\n\nStelle eine kurze Rückfrage (max. 1 Satz)\n\nStartsignal:\n\nstartScraping = true, wenn Branche und (PLZ oder Stadt) eindeutig vorliegen\n\nAntwortstil\n\nKurz, frech, freundlich\n\nDu sprichst den User als „Boss“ oder „Chef“ an\n\nKein Gelaber, keine Floskeln\n\nImmer direkt: „Zahnärzte in 35633 – läuft, Boss!“\n\nAusgabeformat\n\nAntworte ausschließlich mit einem gültigen JSON-Objekt in folgendem Format:\n\n{\n  \"userMessage\": \"\",\n  \"finderFelixAnswer\": \"\",\n  \"industry\": \"\",\n  \"postalCode\": \"\",\n  \"city\": \"\",\n  \"lookupType\": \"\",\n  \"startScraping\": false\n}\n\nBeispiel Outputs\nA) PLZ vorhanden\n{\n  \"userMessage\": \"Bitte alle Zahnärzte in 35633 finden.\",\n  \"finderFelixAnswer\": \"Zahnärzte in 35633 – läuft, Boss!\",\n  \"industry\": \"Zahnärzte\",\n  \"postalCode\": \"35633\",\n  \"city\": \"\",\n  \"lookupType\": \"postal_code\",\n  \"startScraping\": true\n}\n\nB) Stadt vorhanden\n{\n  \"userMessage\": \"Suche Steuerberater in Wetzlar\",\n  \"finderFelixAnswer\": \"Steuerberater in Wetzlar – läuft, Boss!\",\n  \"industry\": \"Steuerberater\",\n  \"postalCode\": \"\",\n  \"city\": \"Wetzlar\",\n  \"lookupType\": \"city\",\n  \"startScraping\": true\n}\n\nC) Rückfrage nötig\n{\n  \"userMessage\": \"35633\",\n  \"finderFelixAnswer\": \"Welche Branche soll ich in 35633 suchen, Boss?\",\n  \"industry\": \"\",\n  \"postalCode\": \"35633\",\n  \"city\": \"\",\n  \"lookupType\": \"postal_code\",\n  \"startScraping\": false\n}\n"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.9,
        "position": [
          -416,
          368
        ],
        "id": "03c09243-cf5b-416f-a84f-9a09921b7011",
        "name": "Finder Felix"
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "german_cities",
          "filters": {
            "conditions": [
              {
                "keyName": "state",
                "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabaseTool",
        "typeVersion": 1,
        "position": [
          -400,
          608
        ],
        "id": "f1ef7ca5-4390-4881-a98b-a5915685a8e6",
        "name": "Check_State",
        "credentials": {
          "supabaseApi": {
            "id": "fdzgJDGuPA2JozKn",
            "name": "Supabase account"
          }
        }
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "german_cities",
          "filters": {
            "conditions": [
              {
                "keyName": "city",
                "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabaseTool",
        "typeVersion": 1,
        "position": [
          -256,
          608
        ],
        "id": "52fb9451-5d77-4cc6-99c5-85fe4e713a95",
        "name": "Check_City",
        "credentials": {
          "supabaseApi": {
            "id": "fdzgJDGuPA2JozKn",
            "name": "Supabase account"
          }
        }
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "german_districts",
          "filters": {
            "conditions": [
              {
                "keyName": "district",
                "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabaseTool",
        "typeVersion": 1,
        "position": [
          -112,
          608
        ],
        "id": "2bc805b4-9c7f-472c-b098-e940f8f6c676",
        "name": "Check_District",
        "credentials": {
          "supabaseApi": {
            "id": "fdzgJDGuPA2JozKn",
            "name": "Supabase account"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "4d17cc19-9718-4ca8-8a95-71655e348f07",
                "leftValue": "={{ $('Finder Felix').item.json.output.industry }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              },
              {
                "id": "fc028b7e-c3fe-4730-93e7-46a4f7030dfa",
                "leftValue": "={{ $('Finder Felix').item.json.output.lookupType }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              },
              {
                "id": "664fa3e0-b57a-4f48-abe2-abed4edb9fdf",
                "leftValue": "={{ $('Finder Felix').item.json.output.startScraping }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          304,
          368
        ],
        "id": "cdba4195-dd77-4c61-a05e-b163034c05a9",
        "name": "Start Scraping"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Finder Felix').item.json.output.lookupType }}",
                      "rightValue": "state",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "583a0988-22cd-4b0d-9414-48fb3a1c48fa"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Scrape State"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "eb932fbc-cf49-4a60-bd1e-deb8e826782b",
                      "leftValue": "={{ $('Finder Felix').item.json.output.lookupType }}",
                      "rightValue": "city",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Scrape City"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "f0d45210-8f03-4e4b-86f9-ade6b9fd36c6",
                      "leftValue": "={{ $('Finder Felix').item.json.output.lookupType }}",
                      "rightValue": "district",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Scrape District"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "a233ce9c-37dd-4d80-a12a-cddf74cc0503",
                      "leftValue": "={{ $('Finder Felix').item.json.output.lookupType }}",
                      "rightValue": "postal_code",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "postal_code"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          544,
          288
        ],
        "id": "d12b07ae-511b-4ed3-ac87-b00aaabd77a3",
        "name": "Switch"
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "german_districts",
          "returnAll": true,
          "filters": {
            "conditions": [
              {
                "keyName": "city",
                "condition": "ilike",
                "keyValue": "={{ $('Finder Felix').item.json.output.city }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          832,
          192
        ],
        "id": "99350954-6488-463f-8fd7-d6a8be88b07f",
        "name": "Get City",
        "credentials": {
          "supabaseApi": {
            "id": "fdzgJDGuPA2JozKn",
            "name": "Supabase account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "51746dd0-2087-430b-aef5-76424ac07607",
                "name": "supabaseProjectID",
                "value": "sbbaxnrkennoyqxcpxmq",
                "type": "string"
              }
            ]
          },
          "includeOtherFields": true,
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -592,
          368
        ],
        "id": "5e3a243c-05d7-4db0-b350-aabd8fe4f460",
        "name": "ENV"
      },
      {
        "parameters": {
          "jsCode": "// Pull structured output once\nconst out = $('Finder Felix').first().json.output || {};\n\n// Back-compat shim (if some nodes still send locationType)\nout.lookupType = out.lookupType || out.locationType || '';\n\n// --- helpers ---\nconst slug = (s) => String(s || '')\n  .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n  .replace(/ä/g,'ae').replace(/ö/g,'oe').replace(/ü/g,'ue')\n  .replace(/Ä/g,'Ae').replace(/Ö/g,'Oe').replace(/Ü/g,'Ue')\n  .replace(/ß/g,'ss')\n  .toLowerCase()\n  .trim()\n  .replace(/[^a-z0-9]+/g,'-')\n  .replace(/^-+|-+$/g,'');\n\n// Minimal industry → slug map (extend as needed)\nconst industryMap = {\n  'zahnärzte': 'zahnarzt',\n  'zahnarzt': 'zahnarzt',\n  'dentists': 'zahnarzt',\n  'steuerberater': 'steuerberater',\n  'anwalt': 'rechtsanwalt',\n};\nconst rawIndustry = String(out.industry || '').toLowerCase().trim();\nconst categorySlug = industryMap[rawIndustry] || slug(rawIndustry) || 'zahnarzt';\n\n// Resolve location from lookupType\nlet locationSegment = '';\nif (out.lookupType === 'postal_code') {\n  locationSegment = String(out.postalCode || '').trim();\n} else if (out.lookupType === 'city') {\n  locationSegment = slug(out.city);\n} else {\n  throw new Error('lookupType must be \"postal_code\" or \"city\".');\n}\nif (!locationSegment) throw new Error('Missing location (postalCode or city).');\n\n// Build URLs\nconst sucheUrl = `https://www.gelbeseiten.de/suche/${categorySlug}/${encodeURIComponent(locationSegment)}`;\n// Optional alternate:\n// const branchenUrl = `https://www.gelbeseiten.de/branchen/${categorySlug}/${encodeURIComponent(locationSegment)}`;\n\nreturn [\n  {\n    json: {\n      url: sucheUrl,\n      // altUrl: branchenUrl,   // uncomment if you want a fallback candidate\n      parts: {\n        lookupType: out.lookupType,\n        categorySlug,\n        locationSegment\n      },\n      debug: {\n        industryInput: out.industry,\n        cityInput: out.city || '',\n        postalCodeInput: out.postalCode || ''\n      }\n    }\n  }\n];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1312,
          400
        ],
        "id": "d6e3acfe-dad5-40b8-8f82-09394f512bd1",
        "name": "Build URL"
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "german_districts",
          "returnAll": true,
          "filters": {
            "conditions": [
              {
                "keyName": "state",
                "condition": "ilike",
                "keyValue": "={{ $('Finder Felix').item.json.output.state }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          832,
          0
        ],
        "id": "5034a563-f2f9-431f-8714-8b6aa2479fc8",
        "name": "Get State",
        "credentials": {
          "supabaseApi": {
            "id": "fdzgJDGuPA2JozKn",
            "name": "Supabase account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Just needed to run Once for all items in order to prevent multiple Telegram messages\n\nreturn $input.first();"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1312,
          224
        ],
        "id": "6b9efb96-f351-461c-82e1-9f313624d79f",
        "name": "Code"
      },
      {
        "parameters": {
          "workflowInputs": {
            "values": [
              {
                "name": "userMessage"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1.1,
        "position": [
          -1600,
          208
        ],
        "id": "f4542468-6798-4f3a-8730-fcd5f36bbe85",
        "name": "Team Leader"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-4.1",
            "mode": "list",
            "cachedResultName": "gpt-4.1"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          -704,
          608
        ],
        "id": "a0bb6f9b-162a-4d80-bf3a-11d2a2a27097",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "RMCgUrxutvJgFiK9",
            "name": "Adams Test OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\n  \"userMessage\": \"Bitte alle Zahnärzte in 35633 finden.\",\n  \"finderFelixAnswer\": \"Zahnärzte in 35633 – läuft, Boss!\",\n  \"industry\": \"Zahnärzte\",\n  \"postalCode\": \"35633\",\n  \"city\": \"\",\n  \"lookupType\": \"postal_code\",\n  \"startScraping\": true\n}\n"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.2,
        "position": [
          16,
          608
        ],
        "id": "c512508f-88f4-4da4-981a-702188def6d3",
        "name": "Structured Output Parser"
      },
      {
        "parameters": {
          "content": "## Finder Felix\n",
          "height": 1088,
          "width": 1936,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -1680,
          -64
        ],
        "id": "0d0680d5-7319-43e1-b6f5-9602cf1de121",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "167pvvSqPMJdFm9r-aJRDDTXlWd_N7IwzvY1oz_7gals",
            "mode": "list",
            "cachedResultName": "Companies - AI Sales Team",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/167pvvSqPMJdFm9r-aJRDDTXlWd_N7IwzvY1oz_7gals/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Tabellenblatt1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/167pvvSqPMJdFm9r-aJRDDTXlWd_N7IwzvY1oz_7gals/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "company": "={{ $json.contactInfo.companyName }}",
              "phone": "={{ $json.contactInfo.phoneNumber }}",
              "website": "={{ $json.contactInfo.website }}",
              "address": "={{ $json.contactInfo.fullAddress }}",
              "industry": "={{ $('Finder Felix').item.json.output.industry }}",
              "state": "={{ $('Loop Over Items').item.json.state }}",
              "city": "={{ $('Loop Over Items').item.json.city }}",
              "district": "={{ $('Loop Over Items').item.json.district }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "company",
                "displayName": "company",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "industry",
                "displayName": "industry",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "phone",
                "displayName": "phone",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "website",
                "displayName": "website",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "address",
                "displayName": "address",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "state",
                "displayName": "state",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "city",
                "displayName": "city",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "district",
                "displayName": "district",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          2144,
          720
        ],
        "id": "047efc07-a24a-438d-b2e1-f1a9d63fdf5c",
        "name": "Append row in sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "qJ5ck4AVx9Jx37Fr",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "let message = '';\nif($prevNode.name === 'Team Leader'){\n  \n  message = { \n    text: $input.first().json.userMessage\n  };\n}else if($prevNode.name === 'Message Felix'){\n  message = $input.first().json.message;\n}\n\nreturn {\n  message: message\n}"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -768,
          368
        ],
        "id": "20455ef4-2724-443a-9ebf-5db0b9ea1b02",
        "name": "Code1"
      },
      {
        "parameters": {
          "tableId": "finder_felix_executions",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "execution",
                "fieldValue": "={{ $execution.id }}"
              },
              {
                "fieldId": "postal_code",
                "fieldValue": "={{ $('Loop Over Items').item.json.output.postalCode }}"
              },
              {
                "fieldId": "num_results",
                "fieldValue": "={{ $input.all().length }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          2368,
          816
        ],
        "id": "384d91af-91a3-47e0-aa22-3c2ec50bcbcb",
        "name": "Create a row",
        "executeOnce": true,
        "credentials": {
          "supabaseApi": {
            "id": "fdzgJDGuPA2JozKn",
            "name": "Supabase account"
          }
        }
      },
      {
        "parameters": {
          "mode": "combine",
          "combineBy": "combineAll",
          "options": {}
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          2576,
          736
        ],
        "id": "0bf09536-71e9-49f7-929c-71210845b2d6",
        "name": "Merge"
      },
      {
        "parameters": {
          "content": "",
          "height": 848,
          "width": 2048,
          "color": 7
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          976,
          176
        ],
        "id": "f805b85f-2e94-4ef4-8e0e-8b59a873ec47",
        "name": "Sticky Note1"
      }
    ],
    "connections": {
      "Search Request": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Detail Request": {
        "main": [
          [
            {
              "node": "Extract Info Section",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Company Cards": {
        "main": [
          [
            {
              "node": "Extract Detail Pages",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out Detail Pages": {
        "main": [
          [
            {
              "node": "Detail Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Info Section": {
        "main": [
          [
            {
              "node": "Extract Cotact Info",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Cotact Info": {
        "main": [
          [
            {
              "node": "Remove Duplicates",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Detail Pages": {
        "main": [
          [
            {
              "node": "Split Out Detail Pages",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [
            {
              "node": "Code",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Build URL",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add Company": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "Extract Company Cards",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Remove Duplicates": {
        "main": [
          [
            {
              "node": "Append row in sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "Finder Felix",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Finder Felix": {
        "main": [
          [
            {
              "node": "Start Scraping",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check_State": {
        "ai_tool": [
          [
            {
              "node": "Finder Felix",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Check_City": {
        "ai_tool": [
          [
            {
              "node": "Finder Felix",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Check_District": {
        "ai_tool": [
          [
            {
              "node": "Finder Felix",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Start Scraping": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Get State",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get City",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get City": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ENV": {
        "main": [
          [
            {
              "node": "Finder Felix",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Build URL": {
        "main": [
          [
            {
              "node": "Search Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get State": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code": {
        "main": [
          []
        ]
      },
      "Team Leader": {
        "main": [
          [
            {
              "node": "Code1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Finder Felix",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser": {
        "ai_outputParser": [
          [
            {
              "node": "Finder Felix",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Append row in sheet": {
        "main": [
          [
            {
              "node": "Create a row",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code1": {
        "main": [
          [
            {
              "node": "ENV",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create a row": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "Add Company",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "system migration",
    "name": null,
    "description": null
  },
  "tags": []
}